<!-- templates/include/nav_menu.html -->
{% load user_extras %}
<ul class="navbar-nav me-auto">
    {% for item in menu %}
        <li class="nav-item">
            <a class="nav-link" href="{% url item.url_name %}">
                {% if item.title == 'Главная' %}
                    <i class="bi bi-house-door me-1"></i>
                {% elif item.title == 'О проекте' %}
                    <i class="bi bi-info-circle me-1"></i>
                {% elif item.title == 'Каталог' %}
                    <i class="bi bi-grid me-1"></i>
                {% endif %}
                {{ item.title }}
            </a>
        </li>
        {% if not forloop.last %}
            <li class="nav-item"><hr class="dropdown-divider"/></li>
        {% endif %}
    {% endfor %}

    <!-- Добавляем разделитель перед пунктами управления -->
    <li class="nav-item"><hr class="dropdown-divider"/></li>

    <!-- УДАЛЕНЫ кнопки "Избранное" и "Добавить статью" -->

    <!-- Пункт "Загрузить из JSON" - только для модераторов и админов -->
    {% if user.is_authenticated %}
        {% if user.is_superuser or user|has_group:'Moderator' %}
        <li class="nav-item">
           <a class="nav-link" href="{% url 'news:upload_json' %}">
               <i class="bi bi-upload me-1"></i> Загрузить из JSON
          </a>
        </li>
        {% endif %}
    {% endif %}

   <!-- Добавляем разделитель и пункт для входа/выхода -->
    {% if user.is_authenticated %}
    <!-- Если пользователь авторизован - показываем выпадающее меню пользователя -->
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="{% url 'users:profile' %}" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-circle me-1"></i> {{ user.username }}
            {% if user.is_superuser %}
                <span class="badge bg-danger">Admin</span>
            {% elif user|has_group:'Moderator' %}
                <span class="badge bg-warning text-dark">Moderator</span>
            {% endif %}
        </a>
        <ul class="dropdown-menu" aria-labelledby="userDropdown">
            <li>
                <a class="dropdown-item" href="{% url 'users:profile' %}">
                    <i class="bi bi-person me-2"></i>Мой профиль
                </a>
            </li>
            <li>
                <a class="dropdown-item" href="{% url 'account_email' %}">
                    <i class="bi bi-envelope me-2"></i>Управление Email
                </a>
            </li>
            <li>
                <a class="dropdown-item" href="{% url 'account_change_password' %}">
                    <i class="bi bi-key me-2"></i>Изменить пароль
                </a>
            </li>
            <li>
                <a class="dropdown-item" href="{% url 'socialaccount_connections' %}">
                    <i class="bi bi-link-45deg me-2"></i>Управление соцсетями
                </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
                <form method="post" action="{% url 'account_logout' %}" class="m-0 p-0">
                    {% csrf_token %}
                    <button type="submit" class="dropdown-item">
                        <i class="bi bi-box-arrow-right me-2"></i>Выход
                    </button>
                </form>
            </li>
        </ul>
    </li>
    {% else %}
    <!-- Если пользователь не авторизован - показываем кнопки входа и регистрации -->
    <li class="nav-item">
        <a class="nav-link" href="{% url 'account_login' %}">
            <i class="bi bi-box-arrow-in-right me-1"></i> Вход
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'account_signup' %}">
            <i class="bi bi-person-plus me-1"></i> Регистрация
        </a>
    </li>
    {% endif %}
</ul>